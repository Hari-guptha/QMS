<?xml version="1.0" encoding="utf-8"?>
<configuration>

  <!-- Environment Variables -->
  <appSettings>
    <add key="NODE_ENV" value="production" />
    <add key="PORT" value="9001" />

    <!-- Database -->
    <add key="DB_HOST" value="160.25.62.77" />
    <add key="DB_PORT" value="1433" />
    <add key="DB_USERNAME" value="Cognicoders" />
    <add key="DB_PASSWORD" value="jan2026Expo" />
    <add key="DB_DATABASE" value="queuemanagement" />

    <add key="DATABASE_URL"
         value="sqlserver://160.25.62.77:1433;database=queuemanagement;user=Cognicoders;password=jan2026Expo;encrypt=true;trustServerCertificate=true" />
    <!-- JWT -->
    <add key="JWT_SECRET" value="your-super-secret-jwt-key-change-in-production-min-32-chars" />
    <add key="JWT_EXPIRES_IN" value="15m" />
    <add key="JWT_REFRESH_SECRET" value="your-super-secret-refresh-key-change-in-production-min-32-chars" />
    <add key="JWT_REFRESH_EXPIRES_IN" value="7d" />

    <!-- Redis -->
    <add key="REDIS_HOST" value="localhost" />
    <add key="REDIS_PORT" value="6379" />

    <!-- Email / SMS -->
    <add key="TWILIO_ACCOUNT_SID" value="your-twilio-account-sid" />
    <add key="TWILIO_AUTH_TOKEN" value="your-twilio-auth-token" />
    <add key="TWILIO_PHONE_NUMBER" value="+1234567890" />
    <add key="RESEND_API_KEY" value="your-resend-api-key" />
    <add key="RESEND_FROM_EMAIL" value="noreply@yourdomain.com" />
  </appSettings>

  <system.webServer>

    <!-- IIS Node -->
    <handlers>
      <add name="iisnode"
          path="dist/src/main.js"
           verb="*"
           modules="iisnode" />
    </handlers>

    <modules>
      <remove name="WebDAVModule" />
    </modules>

    <security>
      <requestFiltering>
        <verbs allowUnlisted="true">
          <remove verb="DELETE" />
          <add verb="DELETE" allowed="true" />
          <add verb="OPTIONS" allowed="true" />
        </verbs>
      </requestFiltering>
    </security>

    <iisnode
      node_env="production"
      loggingEnabled="true"
      debuggingEnabled="false"
      devErrorsEnabled="false"
      flushResponse="true"
      enableXFF="true" />

    <!-- Route everything to NestJS -->
    <rewrite>
      <rules>
        <rule name="NestAPI" stopProcessing="true">
          <match url=".*" />
          <action type="Rewrite" url="dist/src/main.js" />
        </rule>
      </rules>
    </rewrite>

    <httpErrors existingResponse="PassThrough" />

    <!-- CORS headers for preflight and simple requests -->
    <httpProtocol>
      <customHeaders>
        <add name="Access-Control-Allow-Origin" value="http://160.25.62.77:9000" />
        <add name="Access-Control-Allow-Methods" value="GET, POST, PUT, PATCH, DELETE, OPTIONS" />
        <add name="Access-Control-Allow-Headers" value="Content-Type, Authorization, Accept, Accept-Language, Origin, Referer, User-Agent, X-Requested-With" />
        <add name="Access-Control-Allow-Credentials" value="true" />
        <add name="Access-Control-Expose-Headers" value="Content-Length, Content-Type" />
      </customHeaders>
    </httpProtocol>

  </system.webServer>
</configuration>
